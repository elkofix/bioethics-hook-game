(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2991:(e,t,i)=>{"use strict";i.d(t,{default:()=>c});var s=i(5155),r=i(2115);class a{getRandomColor(){let e=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff"];return e[Math.floor(Math.random()*e.length)]}update(e){this.age+=.01,this.energy-=.12,this.reproductionCooldown=Math.max(0,this.reproductionCooldown-1),this.healEffect=Math.max(0,this.healEffect-2),this.wellFedFrenzyTicks=Math.max(0,this.wellFedFrenzyTicks-1);let t="age_of_abundance"===e.era?58:18;if(!this.isPlayer){if(this.age>t)this.health=0;else if(this.age>80){let e=(this.age-80)/(t-80);Math.random()<.02*e*e&&(this.health=0)}}this.medicalLevel>0&&(this.isPlayer||this.age<t)&&(this.health=Math.min(100,this.health+.05*this.medicalLevel),this.medicalLevel-=.01),this.updateBehavior(e),this.move(),this.checkBoundaries(e),this.energy<=0&&(this.isPlayer||this.age<t)&&(this.health=0)}updateBehavior(e){this.energy<50&&.1>Math.random()&&this.forage(e);let t=e.entities.filter(e=>e.id!==this.id&&50>this.distanceTo(e));if(t.length>0){let i=t.reduce((e,t)=>this.distanceTo(e)<this.distanceTo(t)?e:t),s=this.wellFedFrenzyTicks>0?3.5:1,r="age_of_abundance"===e.era?25:1,a=Math.max(.05,1-e.entities.length/80),l="age_of_abundance"===e.era?.5:.04;0===this.reproductionCooldown&&0===i.reproductionCooldown&&this.energy>30&&i.energy>30&&this.age>15&&this.age<90&&Math.random()<l*a*s*r?this.reproduce(i,e):this.distanceTo(i)>20&&this.moveTowards(i.x,i.y,.2)}else .1>Math.random()&&(this.vx+=(Math.random()-.5)*.5,this.vy+=(Math.random()-.5)*.5)}forage(e){if(e.totalResources>0&&!e.resourcesDepleted){let t="age_of_abundance"===e.era?5:1;e.totalResources=Math.max(0,e.totalResources-t),this.energy=Math.min(100,this.energy+30)}}reproduce(e,t){if(t.entities.length<300){let i=new a((this.x+e.x)/2,(this.y+e.y)/2);t.entities.push(i);let s="age_of_abundance"===t.era?5:40,r="age_of_abundance"===t.era?5:120;this.reproductionCooldown=r,e.reproductionCooldown=r,this.energy-=s,e.energy-=s}}moveTowards(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=e-this.x,r=t-this.y,a=Math.sqrt(s*s+r*r);a>0&&(this.vx+=s/a*i*.1,this.vy+=r/a*i*.1)}move(){this.vx*=.95,this.vy*=.95;let e=Math.sqrt(this.vx*this.vx+this.vy*this.vy);e>2&&(this.vx=this.vx/e*2,this.vy=this.vy/e*2),this.x+=this.vx,this.y+=this.vy}checkBoundaries(e){this.x<10&&(this.x=10,this.vx=Math.abs(this.vx)),this.x>e.width-10&&(this.x=e.width-10,this.vx=-Math.abs(this.vx)),this.y<10&&(this.y=10,this.vy=Math.abs(this.vy)),this.y>e.height-10&&(this.y=e.height-10,this.vy=-Math.abs(this.vy))}distanceTo(e){let t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)}draw(e,t){e.save(),e.imageSmoothingEnabled=!1;let i=(t,i,s)=>{e.fillStyle=s,e.fillRect(this.x-8+2*t,this.y-12+2*i,2,2)},s=this.isPlayer?"#f2a952":this.getHairColor(),r=this.isPlayer?"#b820b8":this.color,a=this.isPlayer?"#fa54f3":this.getSkinColor(),l=[[0,0,1,1,1,1,0,0],[0,1,1,1,1,1,1,0],[0,1,2,1,1,2,1,0],[0,1,1,3,3,1,1,0],[0,1,1,1,1,1,1,0],[0,0,4,4,4,4,0,0],[0,4,4,4,4,4,4,0],[0,4,4,4,4,4,4,0],[0,4,4,0,0,4,4,0],[0,5,5,0,0,5,5,0],[0,5,5,0,0,5,5,0],[0,6,6,0,0,6,6,0]],o={0:null,1:s,2:"#000000",3:a,4:r,5:this.isPlayer?"#daf051":"#2c3e50",6:this.isPlayer?"#f2a952":"#8b4513"};for(let e=0;e<l.length;e++)for(let t=0;t<l[e].length;t++){let s=l[e][t];if(0!==s){let r=o[s];r&&i(t,e,r)}}e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(this.x-8,this.y+12,16,2);let n=this.y-12-4;if(e.fillStyle="#8b0000",e.fillRect(this.x-8,n,16,2),e.fillStyle=this.energy>30?"#00ff00":"#ffff00",this.energy<15&&(e.fillStyle="#ff0000"),e.fillRect(this.x-8,n,16*(this.energy/100),2),this.wellFedFrenzyTicks>0){let i=(2+(.5*Math.sin(20*t)+.5))*2,s=this.x-i/2,r=this.y-12-10;e.fillStyle="#ff69b4",e.fillRect(s,r,i,i)}this.isPlayer&&(e.font="10px monospace",e.fillStyle="#ffffff",e.strokeStyle="#000000",e.lineWidth=2,e.strokeText("T\xfa",this.x-6,this.y-20),e.fillText("T\xfa",this.x-6,this.y-20)),e.restore()}getSkinColor(){return["#ffdbac","#f1c27d","#e0ac69","#c68642","#8d5524"][this.skinColorIndex]}getHairColor(){return["#8b4513","#daa520","#000000","#654321","#d2691e","#2f4f4f"][this.hairColorIndex]}receiveFood(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.energy=100,this.health=100,this.wellFedFrenzyTicks=600}receiveMedicine(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;(this.isPlayer||this.age<18)&&(this.medicalLevel=Math.min(5,this.medicalLevel+e),this.health=Math.min(100,this.health+20*e),this.healEffect=100)}constructor(e,t,i=!1){this.x=e,this.y=t,this.vx=(Math.random()-.5)*2,this.vy=(Math.random()-.5)*2,this.health=100,this.energy=100,this.age=0,this.size=4+3*Math.random(),this.color=this.getRandomColor(),this.target=null,this.behavior="wander",this.reproductionCooldown=0,this.skinColorIndex=Math.floor(5*Math.random()),this.hairColorIndex=Math.floor(6*Math.random()),this.id=Math.random(),this.healEffect=0,this.medicalLevel=0,this.wellFedFrenzyTicks=0,this.isPlayer=i}}var l=i(3034);let o=(e,t,i)=>{e.imageSmoothingEnabled=!1,e.fillStyle="#228b22",e.fillRect(0,0,t,i),e.fillStyle="#32cd32";for(let s=0;s<t;s+=8)for(let t=0;t<i;t+=8).3>Math.random()&&e.fillRect(s,t,2,2);e.fillStyle="#8b4513";for(let s=0;s<10;s++){let r=(123*s+456)%t,a=(789*s+101)%i;e.fillRect(r,a,4,8),e.fillStyle="#006400",e.fillRect(r-2,a-4,8,8),e.fillStyle="#8b4513"}},n=e=>{let{onStart:t}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-gray-800 border border-gray-700 text-white p-6 rounded-lg max-w-sm w-full shadow-2xl",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4 text-purple-400",children:"Bienvenido al Simulador"}),(0,s.jsxs)("div",{className:"space-y-3 text-sm mb-4",children:[(0,s.jsx)("p",{children:"\uD83C\uDFAF Tu objetivo es hacer que la poblaci\xf3n sobreviva."}),(0,s.jsx)("p",{children:"\uD83C\uDF4E Haz clic sobre un grupo para alimentarlos."}),(0,s.jsxs)("p",{children:["\uD83D\uDC64 ",(0,s.jsx)("strong",{children:"T\xfa"})," eres el personaje especial que nunca muere."]})]}),(0,s.jsx)("button",{onClick:t,className:"mt-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded w-full font-semibold",children:"Iniciar Simulaci\xf3n"})]})})},h=e=>{let{modalData:t}=e;return t.visible?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:"good"===t.type?(0,s.jsxs)("div",{className:"bg-gray-800 border border-green-500 text-white p-6 rounded-lg max-w-sm w-full shadow-2xl text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-3 text-green-400",children:"Final Bueno"}),(0,s.jsx)("img",{src:"/happy.png",alt:"Poblaci\xf3n Feliz",className:"mx-auto my-4 w-24 h-24 rounded-full border-2 border-green-400"}),(0,s.jsx)("p",{className:"text-sm mb-2",children:"\xa1Salvaste a la poblaci\xf3n!"}),(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-5",children:"Felicidades, usaste los recursos de forma responsable lo cual permiti\xf3 que la poblaci\xf3n permanezca estable."})]}):(0,s.jsxs)("div",{className:"bg-gray-800 border border-red-500 text-white p-6 rounded-lg max-w-sm w-full shadow-2xl text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-3 text-red-400",children:"Final Malo"}),(0,s.jsx)("img",{src:"/sad.png",alt:"Poblaci\xf3n Triste",className:"mx-auto my-4 w-24 h-24 rounded-full border-2 border-red-400"}),(0,s.jsx)("p",{className:"text-sm mb-2",children:"Generaste una hambruna..."}),(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-5",children:"Los recursos se agotaron, lo que hizo que la poblaci\xf3n no prospere y colapse."})]})}):null},c=()=>{let e=(0,r.useRef)(null),t=(0,r.useRef)(null);(0,r.useRef)(0);let i=(0,r.useRef)(null),c=(0,r.useRef)(0),[d,u]=(0,r.useState)(!1),[f]=(0,r.useState)(50),[m,g]=(0,r.useState)(!0),[x,y]=(0,r.useState)("running"),[b,p]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[S,M]=(0,r.useState)("stable"),j=(0,r.useRef)({entities:[],width:350,height:400,time:0,totalResources:200,history:[],era:"stable",resourcesDepleted:!1});(0,r.useEffect)(()=>{let e=l.vr(e=>{!e.isStarted&&d&&T()});return()=>e()},[d]),(0,r.useEffect)(()=>{R()},[f]),(0,r.useEffect)(()=>(d?t.current=requestAnimationFrame(D):t.current&&cancelAnimationFrame(t.current),()=>{t.current&&cancelAnimationFrame(t.current)}),[d,S]),(0,r.useEffect)(()=>("ending"===x&&C(),()=>{i.current&&cancelAnimationFrame(i.current)}),[x]);let R=()=>{let e=j.current;e.entities=[],e.time=0,e.totalResources=200,e.history=[],e.era="stable",e.resourcesDepleted=!1;let t=new a(e.width/2,e.height/2,!0);e.entities.push(t);for(let t=0;t<f-1;t++)e.entities.push(new a(Math.random()*e.width,Math.random()*e.height))},D=()=>{let i=e.current;if(!i)return;let s=i.getContext("2d");if(!s)return;let r=j.current;r.entities.forEach(e=>e.update(r)),!r.resourcesDepleted&&r.totalResources>0&&(r.totalResources=Math.min(240,r.totalResources+.25)),r.totalResources<=0&&!r.resourcesDepleted&&(r.resourcesDepleted=!0,w(!0),r.totalResources=0),o(s,r.width,r.height),r.entities=r.entities.filter(e=>e.health>0||e.isPlayer);let a=r.entities.find(e=>e.isPlayer);a&&a.health<=0&&(a.health=100,a.energy=100),j.current.era=S,r.entities.sort((e,t)=>e.y-t.y),r.entities.forEach(e=>e.draw(s,r.time)),s.font="14px monospace",s.fillStyle="white",s.fillText("\uD83D\uDC65: ".concat(r.entities.length),10,20),s.fillStyle=r.totalResources<20&&!r.resourcesDepleted?"red":"white",s.fillText("\uD83C\uDF3F: ".concat(Math.floor(r.totalResources)),10,40),r.resourcesDepleted&&(s.fillStyle="red",s.fillText("\uD83D\uDEAB RECURSOS AGOTADOS",10,60)),"age_of_abundance"===S&&(s.fillStyle="rgba(255, 215, 0, 0.7)",s.fillText("\uD83E\uDD8B La poblaci\xf3n se ve diferente...",10,80)),r.time+=.1,d&&(t.current=requestAnimationFrame(D))},C=()=>{let t=e.current;if(!t)return;let s=t.getContext("2d");if(!s)return;let r=j.current,a=r.entities.find(e=>e.isPlayer);if(!a)return;o(s,r.width,r.height);let l=r.width/2,n=r.height/2;a.moveTowards(l,n,.5),a.move(),r.entities.sort((e,t)=>e.y-t.y).forEach(e=>e.draw(s,r.time)),2>a.distanceTo({x:l,y:n})?(a.x=l,a.y=n,a.vx=0,a.vy=0,o(s,r.width,r.height),r.entities.forEach(e=>e.draw(s,r.time)),(null==b?void 0:b.type)==="good"?((e,t)=>{let i=[[0,1,0,1,0],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]],s=3*i[0].length,r=t.x-s/2,a=t.y-35;e.fillStyle="#ff69b4";for(let t=0;t<i.length;t++)for(let s=0;s<i[t].length;s++)1===i[t][s]&&e.fillRect(r+3*s,a+3*t,3,3)})(s,a):((e,t)=>{e.font="bold 20px monospace",e.fillStyle="#ffdd00",e.strokeStyle="black",e.lineWidth=3,e.textAlign="center",e.strokeText("\xa1ahhhh!",t.x,t.y-25),e.fillText("\xa1ahhhh!",t.x,t.y-25)})(s,a),y("finished"),i.current&&cancelAnimationFrame(i.current),setTimeout(()=>{p(e=>e?{...e,visible:!0}:null)},1500)):i.current=requestAnimationFrame(C)},T=async()=>{"running"===x&&(await l.es(!1),j.current.resourcesDepleted||j.current.totalResources<=0?(await l.rq("lose"),u(!1),y("ending"),j.current.entities=j.current.entities.filter(e=>e.isPlayer),p({type:"bad",visible:!1})):(await l.rq("win"),u(!1),y("ending"),p({type:"good",visible:!1})))};return(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 bg-gray-900 min-h-screen",children:[m&&(0,s.jsx)(n,{onStart:()=>{g(!1),u(!0)}}),b&&(0,s.jsx)(h,{modalData:b}),(0,s.jsxs)("div",{className:"relative mb-4",children:[(0,s.jsx)("div",{className:"border-4 border-gray-700 rounded-lg overflow-hidden shadow-2xl",children:(0,s.jsx)("canvas",{ref:e,width:350,height:400,className:"block ".concat(v?"cursor-not-allowed":"cursor-crosshair"),onClick:t=>{if("running"!==x||v)return;let i=e.current;if(!i)return;let s=i.getBoundingClientRect(),r=t.clientX-s.left,a=t.clientY-s.top,l=j.current.entities.filter(e=>50>e.distanceTo({x:r,y:a}));l.length>0&&(c.current++,6===c.current&&"stable"===S&&M("age_of_abundance"),l.forEach(e=>e.receiveFood()))}})}),(0,s.jsxs)("div",{className:"absolute bottom-4 right-4",children:[(0,s.jsx)("div",{className:"p-3 rounded-full shadow-lg transition-colors ".concat(v?"bg-gray-600":"bg-green-600"),children:(0,s.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF4E"})}),(0,s.jsx)("div",{className:"text-white text-xs text-center mt-1",children:"Alimentar"})]})]})]})}},3034:(e,t,i)=>{"use strict";i.d(t,{XO:()=>u,c8:()=>h,rq:()=>o,QM:()=>d,vr:()=>n,es:()=>c});var s=i(2078),r=i(9708);let a=(0,s.Wp)({apiKey:"AIzaSyA8C0WtNC6-Al_GZsU93rP_0YBRDdLMTdQ",authDomain:"bioethics-149f8.firebaseapp.com",projectId:"bioethics-149f8",storageBucket:"bioethics-149f8.firebasestorage.app",messagingSenderId:"213674127804",appId:"1:213674127804:web:660b963a96984f0f18fbb9"}),l=(0,r.aU)(a),o=async e=>{try{await (0,r.gS)((0,r.rJ)(l,"game_results"),{outcome:e}),console.log("Resultado '".concat(e,"' registrado."))}catch(e){console.error("Error registrando resultado:",e)}},n=e=>{let t=(0,r.H9)((0,r.rJ)(l,"game_state"),"status");return(0,r.aQ)(t,t=>{t.exists()&&e(t.data())})},h=async()=>{try{let e=(0,r.H9)((0,r.rJ)(l,"game_state"),"status"),t=await (0,r.x7)(e);if(t.exists())return t.data().isStarted;return console.warn("Documento de estado no encontrado, devolviendo 'false'."),!1}catch(e){return console.error("Error obteniendo el estado del juego:",e),!1}},c=async e=>{try{let t=(0,r.H9)((0,r.rJ)(l,"game_state"),"status");await (0,r.mZ)(t,{isStarted:e})}catch(e){throw console.error("Error actualizando el estado del juego:",e),e}},d=e=>{let t=(0,r.P)((0,r.rJ)(l,"game_results"));return(0,r.aQ)(t,t=>{let i=[];t.forEach(e=>{i.push({id:e.id,...e.data()})}),e(i)})},u=async()=>{try{let e=(0,r.rJ)(l,"game_results"),t=await (0,r.GG)(e);if(t.empty)return void console.log("No hay resultados que eliminar.");let i=(0,r.wP)(l);t.forEach(e=>{i.delete(e.ref)}),await i.commit()}catch(e){throw console.error("Error eliminando todos los resultados:",e),e}}},4588:(e,t,i)=>{Promise.resolve().then(i.bind(i,2991))}},e=>{e.O(0,[135,736,441,255,358],()=>e(e.s=4588)),_N_E=e.O()}]);